# 延续打码功能调试说明

## 问题描述
用户反映设置 `--continuation-frames 30` 和 `--continuation-frames 5` 的效果没有区别。

## 功能验证结果

### 1. 参数传递测试 ✅
- `continuation_frames` 参数正确传递给检测器
- `max_continuation_frames` 正确设置为用户指定的值

### 2. 延续逻辑测试 ✅
- 延续打码逻辑工作正常
- 不同的 `continuation_frames` 值产生不同的延续行为
- 控制台正确显示延续进度信息

## 可能的原因分析

### 1. 视频场景问题
**最可能的原因**：用户测试的视频中可能没有出现需要延续打码的场景，即：
- 视频中人脸检测一直很稳定，没有出现检测失败的情况
- 或者检测失败的持续时间很短（少于5帧），看不出30帧和5帧的区别

### 2. 观察方式问题
用户可能没有注意到：
- **控制台输出**：延续策略激活时会显示 `无人脸检测，使用延续策略 (第X/Y帧)`
- **视觉效果**：延续打码的视觉效果可能不够明显

## 如何验证延续打码功能

### 方法1：观察控制台输出
运行命令时注意观察控制台，当出现以下信息时说明延续策略正在工作：
```
无人脸检测，使用延续策略 (第1/30帧)
无人脸检测，使用延续策略 (第2/30帧)
...
```

### 方法2：使用测试脚本
运行项目中的测试脚本：
```bash
python3 test_continuation_behavior.py
```

### 方法3：对比测试
使用相同视频分别测试不同的延续帧数：
```bash
# 测试5帧延续
python3 main.py video.mp4 --continuation-frames 5 --mosaic --output output_5.mp4

# 测试30帧延续
python3 main.py video.mp4 --continuation-frames 30 --mosaic --output output_30.mp4
```

然后对比两个输出视频，特别关注人脸检测不稳定的片段。

### 方法4：创建测试场景
寻找或创建包含以下场景的测试视频：
- 人物快速转头（正脸→侧脸→背面）
- 人物被遮挡后重新出现
- 光线快速变化的场景
- 人物快速移动的场景

## 预期效果差异

- **5帧延续**：在检测失败后最多延续5帧打码，然后停止
- **30帧延续**：在检测失败后最多延续30帧打码，提供更长的保护时间

## 建议

1. **检查控制台输出**：运行时观察是否有延续策略的提示信息
2. **使用问题视频**：寻找人脸检测不稳定的视频进行测试
3. **对比测试**：使用极端值（如1帧 vs 50帧）进行对比测试
4. **查看处理日志**：注意处理过程中的所有输出信息

## 结论

延续打码功能**工作正常**，参数传递**没有问题**。用户感觉没有区别可能是因为：
1. 测试视频的人脸检测很稳定，没有触发延续策略
2. 没有注意到控制台的延续策略提示信息
3. 延续时间较短，视觉上不够明显

建议用户使用包含人脸检测挑战场景的视频进行测试，并关注控制台输出信息。